# K6 Performance Testing Repository

## Overview
This repository contains performance testing scripts for evaluating the QuickPizza API using [K6](https://k6.io/). The tests simulate different user load scenarios to assess the system's reliability and scalability.

## Repository Structure

- **`k6.exe`** - The executable file to run K6 performance tests.
- **`load-options.js`** - Configuration file defining different load test scenarios.
- **`quickPizzaTestScript.js`** - The primary test script that simulates various user interactions with the QuickPizza API.
- **`README.md`** - Documentation on how to use the repository.

## Prerequisites

Before running the tests, ensure you have the following:
- Node.js installed (for optional dependencies like `k6-summary` reporting)
- K6 installed (or use `k6.exe` included in the repository)
- An active internet connection for API requests

## Running the Tests

1. Install K6 (if not using `k6.exe` from this repository):
   ```sh
   choco install k6 # Windows (using Chocolatey)
   brew install k6  # macOS (using Homebrew)
   ```
2. Set the environment variable for the base URL:
   ```sh
   export BASE_URL=https://quickpizza.grafana.com
   ```
3. Execute the test:
   ```sh
   ./k6.exe run quickPizzaTestScript.js
   ```
   or if K6 is installed globally:
   ```sh
   k6 run quickPizzaTestScript.js
   ```

## Test Script Explanation: `quickPizzaTestScript.js`

This script is structured to simulate multiple test scenarios on the QuickPizza API.

### Key Libraries Used:
- `http`: For making API requests.
- `sleep`: To introduce pauses between requests.
- `check`: To validate response statuses and content.
- `group`: To organize tests into logical sections.
- `exec`: To manage execution contexts.
- `randomString`: To generate random usernames and passwords.
- `htmlReport`: To generate an HTML report of test results.

### Load Testing Scenarios:
The script defines four test scenarios:

1. **Smoke Test**: A quick, minimal test to verify basic API functionality.
2. **Load Test**: Gradually increases the number of virtual users (VUs) to assess system performance under normal load.
3. **Stress Test**: Pushes the API beyond expected limits to identify breaking points.
4. **Spike Test**: Introduces sudden, extreme load to test API resilience.

Each scenario is configured in `load-options.js` and referenced in the script.

### User Flow Simulation (`pizzaUserFlow` Function):

1. **User Authentication:**
   - A new user account is created.
   - The user logs in and retrieves an authentication token.
   - The token is used for subsequent requests.

2. **Main Page API Requests:**
   - Retrieves application configurations.
   - Fetches inspirational quotes.
   - Requests available tools.

3. **Pizza Interactions:**
   - Requests a pizza recommendation based on dietary restrictions.
   - Rates the recommended pizza positively.

4. **User Ratings Management:**
   - Retrieves submitted pizza ratings.
   - Clears all ratings for the user.

### Summary Report:
At the end of the test, K6 generates a report displaying response times, request success rates, and failure counts.

Optionally, an HTML summary report can be generated by uncommenting the `handleSummary` function.

## Thresholds and Assertions
The script defines performance thresholds for response times and request success rates:

- **Successful requests (`checks`)**: Minimum 95% success rate.
- **Request duration (`http_req_duration`)**:
  - 95% of requests should complete within 1000ms.
  - More lenient for spike tests (1500ms threshold).
- **Failed requests (`http_req_failed`)**:
  - Less than 5% failures allowed.

## Generating HTML Reports

For a detailed HTML performance report, install the K6 summary reporter:
```sh
npm install -g k6-summary
```

Then, modify `quickPizzaTestScript.js` to include:
```js
import { htmlReport } from 'https://raw.githubusercontent.com/benc-uk/k6-reporter/main/dist/bundle.js';
export function handleSummary(data) {
    return {
        "summary.html": htmlReport(data),
    };
}
```
Run the test and open `summary.html` in a browser for detailed insights.

## Conclusion
This repository provides a structured approach to performance testing with K6, ensuring that the QuickPizza API maintains stability under different loads. Modify `load-options.js` to adjust test scenarios as needed.

